<?php
/**
 * @var \Zaca\Events\Block\EventCard $block
 */
$event = $block->getEvent();
if (!$event) {
    return;
}

$availableSlots = $block->getAvailableSlots();
$isRegistered = $block->isCustomerRegistered();
$registrationStatus = $block->getRegistrationStatus();
?>
<div class="event-card" data-meet-id="<?= $block->escapeHtml($event->getMeetId()) ?>">
    <div class="event-header">
        <div class="event-name-wrapper">
            <h3 class="event-name">
                <a href="<?= $block->escapeUrl($block->getEventViewUrl($event->getMeetId())) ?>" class="event-name-link">
                    <?= $block->escapeHtml($event->getName()) ?>
                </a>
            </h3>
            <?php if ($block->getThemeName()): ?>
                <span class="event-theme"><?= $block->escapeHtml($block->getThemeName()) ?></span>
            <?php endif; ?>
        </div>
        <span class="event-type"><?= $block->escapeHtml($block->getEventTypeLabel()) ?></span>
    </div>

    <div class="event-details">
        <div class="event-detail">
            <strong><?= $block->escapeHtml(__('Location:')) ?></strong>
            <span><?= $block->escapeHtml($block->getStoreName()) ?></span>
        </div>

        <div class="event-detail">
            <strong><?= $block->escapeHtml(__('Date:')) ?></strong>
            <span><?= $block->escapeHtml($block->getFormattedEventDate()) ?></span>
        </div>

        <div class="event-detail">
            <strong><?= $block->escapeHtml(__('Duration:')) ?></strong>
            <span><?= $block->escapeHtml($event->getDurationMinutes()) ?> <?= $block->escapeHtml(__('minutes')) ?></span>
        </div>

        <div class="event-detail">
            <strong><?= $block->escapeHtml(__('Available Slots:')) ?></strong>
            <span class="slots-count <?= $availableSlots > 0 ? 'available' : 'full' ?>">
                <?= $block->escapeHtml($availableSlots) ?> / <?= $block->escapeHtml($event->getMaxSlots()) ?>
            </span>
        </div>

        <?php if ($event->getDescription()): ?>
            <div class="event-description">
                <?= /* @noEscape */ $block->getDescriptionHtml() ?>
            </div>
        <?php endif; ?>
    </div>

    <div class="event-actions">
        <?php if ($block->isCustomerLoggedIn()): ?>
            <?php if ($isRegistered): ?>
                <div class="registration-status">
                    <?php if ($registrationStatus === 'waitlist'): ?>
                        <span class="status-waitlist"><?= $block->escapeHtml(__('You are on the waitlist')) ?></span>
                    <?php else: ?>
                        <span class="status-confirmed"><?= $block->escapeHtml(__('You are registered')) ?></span>
                    <?php endif; ?>
                </div>
                <button type="button" 
                        class="action secondary unregister-btn" 
                        data-meet-id="<?= $block->escapeHtml($event->getMeetId()) ?>"
                        data-url="<?= $block->escapeUrl($block->getUnregisterUrl($event->getMeetId())) ?>">
                    <?= $block->escapeHtml(__('Unregister')) ?>
                </button>
            <?php else: ?>
                <?php if (!$isRegistered && $availableSlots > 0): ?>
                    <button type="button" 
                            class="action primary register-btn" 
                            data-meet-id="<?= $block->escapeHtml($event->getMeetId()) ?>"
                            data-url="<?= $block->escapeUrl($block->getRegisterUrl($event->getMeetId())) ?>">
                        <?= $block->escapeHtml(__('Register')) ?>
                    </button>
                <?php elseif (!$isRegistered && $availableSlots <= 0): ?>
                    <button type="button" 
                            class="action primary register-btn waitlist-btn" 
                            data-meet-id="<?= $block->escapeHtml($event->getMeetId()) ?>"
                            data-url="<?= $block->escapeUrl($block->getRegisterUrl($event->getMeetId())) ?>">
                        <?= $block->escapeHtml(__('Join Waitlist')) ?>
                    </button>
                <?php endif; ?>
            <?php endif; ?>
        <?php else: ?>
            <a href="<?= $block->escapeUrl($block->getLoginUrlWithReturn()) ?>" 
               class="action primary">
                <?= $block->escapeHtml(__('Login to Register')) ?>
            </a>
        <?php endif; ?>
    </div>
</div>

